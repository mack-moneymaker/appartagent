<div class="max-w-4xl mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">
      <%= @search_profile.city %> <%= @search_profile.arrondissement %>
      <span class="text-lg font-medium px-3 py-1 rounded-full <%= @search_profile.transaction_type == 'sale' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700' %>">
        <%= @search_profile.transaction_label %>
      </span>
    </h1>
    <div class="flex gap-3 items-center">
      <%= button_to "ğŸ”„ RafraÃ®chir", refresh_search_profile_path(@search_profile), method: :patch, class: "bg-primary-100 text-primary-700 px-4 py-2 rounded-lg text-sm hover:bg-primary-200 cursor-pointer" %>
      <a href="<%= edit_search_profile_path(@search_profile) %>" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-200">Modifier</a>
      <a href="<%= dashboard_path %>" class="text-gray-600 text-sm hover:underline py-2">â† Retour</a>
    </div>
  </div>

  <!-- Scrape status -->
  <% if @search_profile.needs_scrape? %>
    <div class="bg-amber-50 border border-amber-200 text-amber-800 px-4 py-3 rounded-lg mb-6 text-sm">
      â³ Recherche en cours sur les plateformes... Les rÃ©sultats apparaÃ®tront sous peu.
    </div>
  <% elsif @search_profile.scraped_at.present? %>
    <div class="text-gray-500 text-sm mb-6">
      âœ… DerniÃ¨re mise Ã  jour : <%= time_ago_in_words(@search_profile.scraped_at) %>
    </div>
  <% end %>

  <!-- Search criteria summary -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
    <h2 class="font-bold text-gray-900 mb-3">CritÃ¨res de recherche</h2>
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
      <div><span class="text-gray-500">Budget</span><br><span class="font-medium"><%= @search_profile.budget_label %></span></div>
      <div><span class="text-gray-500">Surface</span><br><span class="font-medium"><%= @search_profile.surface_label || "â€”" %></span></div>
      <div><span class="text-gray-500">PiÃ¨ces</span><br><span class="font-medium"><%= @search_profile.rooms_label || "â€”" %></span></div>
      <div><span class="text-gray-500">Type</span><br><span class="font-medium"><%= @search_profile.property_type_label || "Tous" %></span></div>
    </div>
  </div>

  <!-- Platform search links -->
  <h2 class="text-xl font-bold text-gray-900 mb-4">ğŸ” Rechercher sur les plateformes</h2>
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10">
    <% @platform_links.each do |platform| %>
      <div class="bg-white rounded-xl shadow-sm border <%= platform[:border_color] %> p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center gap-3 mb-3">
          <span class="text-2xl"><%= platform[:emoji] %></span>
          <h3 class="font-bold text-gray-900 text-lg"><%= platform[:name] %></h3>
        </div>
        <p class="text-gray-600 text-sm mb-4"><%= platform[:description] %></p>
        <a href="<%= platform[:url] %>" target="_blank" rel="noopener"
           class="inline-block w-full text-center bg-primary-600 text-white px-4 py-2.5 rounded-lg font-medium hover:bg-primary-700 transition-colors">
          Rechercher sur <%= platform[:name] %> â†—
        </a>
      </div>
    <% end %>
  </div>

  <!-- Save a listing form -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
    <h2 class="font-bold text-gray-900 mb-3">ğŸ“Œ Sauvegarder une annonce</h2>
    <p class="text-gray-600 text-sm mb-4">TrouvÃ© une annonce intÃ©ressante ? Collez le lien ici pour la sauvegarder et la comparer.</p>
    <%= form_with model: SavedListing.new, url: saved_listings_path, class: "flex gap-3" do |f| %>
      <%= f.hidden_field :search_profile_id, value: @search_profile.id %>
      <%= f.url_field :url, placeholder: "https://www.leboncoin.fr/...", class: "flex-1 border border-gray-300 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500", required: true %>
      <%= f.submit "Ajouter", class: "bg-primary-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-primary-700 cursor-pointer" %>
    <% end %>
  </div>

  <!-- Saved listings for this search -->
  <% if @saved_listings.any? %>
    <h2 class="text-xl font-bold text-gray-900 mb-4">ğŸ“‹ Mes annonces sauvegardÃ©es</h2>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <table class="w-full text-sm">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="text-left px-4 py-3 font-medium text-gray-500">Annonce</th>
            <th class="text-left px-4 py-3 font-medium text-gray-500">Prix</th>
            <th class="text-left px-4 py-3 font-medium text-gray-500">Surface</th>
            <th class="text-left px-4 py-3 font-medium text-gray-500">Statut</th>
            <th class="text-left px-4 py-3 font-medium text-gray-500">Note</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          <% @saved_listings.each do |listing| %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3">
                <a href="<%= listing.url %>" target="_blank" rel="noopener" class="text-primary-600 hover:underline font-medium">
                  <%= listing.title || listing.platform&.capitalize || "Annonce" %>
                </a>
                <% if listing.platform %><span class="text-xs text-gray-400 ml-1">(<%= listing.platform %>)</span><% end %>
              </td>
              <td class="px-4 py-3 font-medium"><%= listing.price ? number_to_currency(listing.price, unit: "â‚¬", format: "%n %u") : "â€”" %></td>
              <td class="px-4 py-3"><%= listing.surface ? "#{listing.surface} mÂ²" : "â€”" %></td>
              <td class="px-4 py-3"><span class="text-xs px-2 py-1 rounded-full <%= listing.status_color %>"><%= listing.status %></span></td>
              <td class="px-4 py-3 text-yellow-500"><%= listing.stars %></td>
              <td class="px-4 py-3 text-right">
                <a href="<%= listing.url %>" target="_blank" rel="noopener" class="text-xs text-gray-500 hover:text-primary-600">â†—</a>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>
