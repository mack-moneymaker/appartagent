<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">üè† Annonces</h1>

  <!-- Filters -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-8">
    <%= form_tag listings_path, method: :get, class: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4" do %>
      <div>
        <label class="block text-xs font-medium text-gray-500 mb-1">Ville</label>
        <%= text_field_tag :city, params[:city], placeholder: "Paris, Lyon...", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-500 mb-1">Prix min</label>
        <%= number_field_tag :min_price, params[:min_price], placeholder: "500 ‚Ç¨", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-500 mb-1">Prix max</label>
        <%= number_field_tag :max_price, params[:max_price], placeholder: "1500 ‚Ç¨", class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
      </div>
      <div>
        <label class="block text-xs font-medium text-gray-500 mb-1">Plateforme</label>
        <%= select_tag :platform, options_for_select([["Toutes", ""], "pap", "seloger", "leboncoin", "bienici"], params[:platform]), class: "w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500" %>
      </div>
      <div class="flex items-end">
        <%= submit_tag "Filtrer", class: "w-full bg-primary-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-700 cursor-pointer" %>
      </div>
    <% end %>
  </div>

  <p class="text-sm text-gray-500 mb-4"><%= @total %> annonce<%= @total > 1 ? 's' : '' %> trouv√©e<%= @total > 1 ? 's' : '' %></p>

  <!-- Listing cards grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @listings.each do |listing| %>
      <a href="<%= listing_path(listing) %>" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow group">
        <!-- Photo -->
        <div class="h-48 bg-gray-100 overflow-hidden">
          <% if listing.first_photo %>
            <img src="<%= listing.first_photo %>" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" alt="">
          <% else %>
            <div class="w-full h-full flex items-center justify-center text-gray-300">
              <span class="text-5xl">üì∑</span>
            </div>
          <% end %>
        </div>

        <div class="p-4">
          <!-- Platform tag + score -->
          <div class="flex justify-between items-center mb-2">
            <span class="text-xs font-medium px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 capitalize"><%= listing.platform %></span>
            <% if listing.score %>
              <%= score_badge(listing.score) %>
            <% end %>
          </div>

          <!-- Title -->
          <h3 class="font-semibold text-gray-900 text-sm mb-1 line-clamp-2"><%= listing.title %></h3>
          <p class="text-xs text-gray-500 mb-3"><%= listing.city %> <%= listing.postal_code %><%= " ‚Äî #{listing.neighborhood}" if listing.neighborhood.present? %></p>

          <!-- Price, surface, rooms -->
          <div class="flex items-center justify-between">
            <span class="text-lg font-bold text-primary-600"><%= number_to_currency(listing.price, unit: "‚Ç¨", format: "%n %u", precision: 0) %><span class="text-xs text-gray-400 font-normal">/mois</span></span>
            <div class="flex gap-3 text-xs text-gray-500">
              <% if listing.surface %>
                <span><%= listing.surface.to_i %> m¬≤</span>
              <% end %>
              <% if listing.rooms %>
                <span><%= listing.rooms %> p.</span>
              <% end %>
            </div>
          </div>
        </div>
      </a>
    <% end %>
  </div>

  <!-- Pagination -->
  <% if @total_pages > 1 %>
    <nav class="flex justify-center mt-8 gap-2">
      <% if @page > 1 %>
        <a href="<%= listings_path(request.query_parameters.merge(page: @page - 1)) %>" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50">‚Üê Pr√©c√©dent</a>
      <% end %>
      <span class="px-4 py-2 text-sm text-gray-500">Page <%= @page %> / <%= @total_pages %></span>
      <% if @page < @total_pages %>
        <a href="<%= listings_path(request.query_parameters.merge(page: @page + 1)) %>" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm hover:bg-gray-50">Suivant ‚Üí</a>
      <% end %>
    </nav>
  <% end %>
</div>
